<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… ØªØ±Ø¬Ù…Ø© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</title>
    <!-- Ù…ÙƒØªØ¨Ø© pdf-lib Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© PDF -->
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <!-- Ù…ÙƒØªØ¨Ø© mammoth Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ù…Ø³ØªÙ†Ø¯Ø§Øª Word -->
    <script src="https://unpkg.com/mammoth@1.4.8/mammoth.browser.min.js"></script>
    <!-- Ù…ÙƒØªØ¨Ø© FileSaver Ù„Ù„ØªØ­Ù…ÙŠÙ„ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <style>
        :root {
            --primary: #3498db;
            --secondary: #2ecc71;
            --accent: #e74c3c;
            --light: #f8f9fa;
            --dark: #343a40;
            --border: #dee2e6;
            --text-dark: #2c3e50;
            --text-light: #ecf0f1;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Cairo', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            color: var(--text-dark);
            line-height: 1.8;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px;
            background: linear-gradient(135deg, var(--primary), #1a5276);
            color: white;
            border-radius: 15px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.15);
        }
        
        h1 {
            font-size: 2.8rem;
            margin-bottom: 15px;
            font-weight: 700;
        }
        
        .subtitle {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 10px;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-top: 30px;
        }
        
        @media (max-width: 992px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            padding: 30px;
            transition: transform 0.4s ease, box-shadow 0.4s ease;
            position: relative;
            overflow: hidden;
        }
        
        .card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--secondary), var(--primary));
        }
        
        .card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.15);
        }
        
        .card-title {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: var(--primary);
            border-bottom: 2px solid var(--border);
            padding-bottom: 15px;
            font-weight: 600;
        }
        
        .upload-area {
            border: 3px dashed var(--border);
            border-radius: 12px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 25px;
            cursor: pointer;
            transition: all 0.3s;
            background-color: rgba(52, 152, 219, 0.05);
        }
        
        .upload-area:hover {
            background-color: rgba(52, 152, 219, 0.1);
            border-color: var(--primary);
        }
        
        .upload-area.drag-over {
            background-color: rgba(46, 204, 113, 0.2);
            border-color: var(--secondary);
        }
        
        .upload-icon {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 20px;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            display: inline-block;
            padding: 14px 28px;
            background: linear-gradient(135deg, var(--primary), #2980b9);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
            margin: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }
        
        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }
        
        .btn:active {
            transform: translateY(1px);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--secondary), #27ae60);
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--accent), #c0392b);
        }
        
        .btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .language-selector {
            display: flex;
            justify-content: center;
            margin: 25px 0;
            background-color: var(--light);
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .language-option {
            padding: 15px 30px;
            background-color: var(--light);
            cursor: pointer;
            flex: 1;
            text-align: center;
            transition: all 0.3s;
            font-weight: 600;
        }
        
        .language-option.active {
            background: linear-gradient(135deg, var(--primary), #2980b9);
            color: white;
        }
        
        .preview-area {
            margin-top: 25px;
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            min-height: 280px;
            max-height: 400px;
            overflow-y: auto;
            background-color: #fafafa;
            line-height: 1.6;
        }
        
        .editor-tools {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }
        
        .tool-btn {
            padding: 12px 20px;
            background-color: var(--light);
            border: 1px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 500;
        }
        
        .tool-btn:hover {
            background-color: #e9ecef;
        }
        
        .tool-btn.active {
            background-color: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .editor {
            border: 1px solid var(--border);
            border-radius: 12px;
            padding: 20px;
            min-height: 280px;
            outline: none;
            background-color: #fafafa;
            line-height: 1.6;
            overflow-y: auto;
        }
        
        .status {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            font-weight: 500;
        }
        
        .status.success {
            background-color: rgba(46, 204, 113, 0.2);
            color: #27ae60;
            border: 1px solid #27ae60;
        }
        
        .status.error {
            background-color: rgba(231, 76, 60, 0.2);
            color: #c0392b;
            border: 1px solid #c0392b;
        }
        
        .status.info {
            background-color: rgba(52, 152, 219, 0.2);
            color: #2980b9;
            border: 1px solid #2980b9;
        }
        
        .file-info {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-right: 4px solid var(--primary);
        }
        
        footer {
            text-align: center;
            margin-top: 60px;
            padding: 30px;
            color: var(--dark);
            opacity: 0.8;
            font-size: 1.1rem;
        }
        
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
            margin-right: 10px;
            vertical-align: middle;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .text-right {
            text-align: right;
        }
        
        .text-center {
            text-align: center;
        }
        
        .mb-3 {
            margin-bottom: 1rem;
        }
        
        .mt-3 {
            margin-top: 1rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Ù†Ø¸Ø§Ù… ØªØ±Ø¬Ù…Ø© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h1>
            <p class="subtitle">ØªØ±Ø¬Ù…Ø© Ù…Ø³ØªÙ†Ø¯Ø§Øª PDF ÙˆWord Ø¨ÙŠÙ† Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© ÙˆØ§Ù„Ø¹Ø±Ø¨ÙŠØ© Ù…Ø¹ Ø¥Ù…ÙƒØ§Ù†ÙŠØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„</p>
        </header>
        
        <div class="main-content">
            <div class="card">
                <h2 class="card-title">ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª</h2>
                
                <div class="upload-area" id="translation-upload">
                    <div class="upload-icon">ğŸ“„</div>
                    <p>Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ù…Ø³ØªÙ†Ø¯ PDF Ø£Ùˆ Word</p>
                    <p class="small">(Ø£Ù‚ØµÙ‰ Ø­Ø¬Ù… Ù„Ù„Ù…Ù„Ù: 10MB)</p>
                    <input type="file" id="translation-file" class="file-input" accept=".pdf,.doc,.docx">
                </div>
                
                <div class="file-info" id="translation-file-info">
                    <p>Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø¹Ø¯</p>
                </div>
                
                <div class="language-selector">
                    <div class="language-option active" data-direction="en-ar">Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</div>
                    <div class="language-option" data-direction="ar-en">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø¥Ù„Ù‰ Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©</div>
                </div>
                
                <div class="text-center">
                    <button class="btn" id="translate-btn">
                        <span id="translate-text">ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯</span>
                        <span id="translate-loading" class="loading" style="display: none;"></span>
                    </button>
                </div>
                
                <div class="status" id="translation-status"></div>
                
                <div class="preview-area" id="translation-preview">
                    <p class="text-center">Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…ØªØ±Ø¬Ù… Ø³ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§...</p>
                </div>
                
                <div class="text-center">
                    <button class="btn btn-secondary" id="download-translation" disabled>ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…ØªØ±Ø¬Ù…</button>
                </div>
            </div>
            
            <div class="card">
                <h2 class="card-title">Ù…Ø­Ø±Ø± PDF</h2>
                
                <div class="upload-area" id="editor-upload">
                    <div class="upload-icon">âœï¸</div>
                    <p>Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ù…Ù„Ù PDF Ù„Ù„ØªØ¹Ø¯ÙŠÙ„</p>
                    <p class="small">(Ø£Ù‚ØµÙ‰ Ø­Ø¬Ù… Ù„Ù„Ù…Ù„Ù: 10MB)</p>
                    <input type="file" id="editor-file" class="file-input" accept=".pdf">
                </div>
                
                <div class="file-info" id="editor-file-info">
                    <p>Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø¨Ø¹Ø¯</p>
                </div>
                
                <div class="editor-tools">
                    <button class="tool-btn" data-tool="text">Ø¥Ø¶Ø§ÙØ© Ù†Øµ</button>
                    <button class="tool-btn" data-tool="highlight">ØªÙ…ÙŠÙŠØ²</button>
                    <button class="tool-btn" data-tool="comment">Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚</button>
                </div>
                
                <div class="editor" id="pdf-editor" contenteditable="true">
                    <p class="text-center">Ù…Ø­ØªÙˆÙŠØ§Øª PDF Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ Ù„Ù„ØªØ­Ø±ÙŠØ±...</p>
                </div>
                
                <div class="status" id="editor-status"></div>
                
                <div class="text-center">
                    <button class="btn btn-secondary" id="save-pdf" disabled>Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
                    <button class="btn" id="download-edited" disabled>ØªØ­Ù…ÙŠÙ„ PDF Ø§Ù„Ù…Ø¹Ø¯Ù„</button>
                </div>
            </div>
        </div>
        
        <footer>
            <p>Ù†Ø¸Ø§Ù… ØªØ±Ø¬Ù…Ø© ÙˆØªØ­Ø±ÙŠØ± Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª &copy; 2023 | Ø§Ù„Ø¯Ø¹Ù…: support@doctranslate.com</p>
        </footer>
    </div>

    <script>
        // DOM Elements
        const translationUpload = document.getElementById('translation-upload');
        const translationFile = document.getElementById('translation-file');
        const translateBtn = document.getElementById('translate-btn');
        const translationStatus = document.getElementById('translation-status');
        const translationPreview = document.getElementById('translation-preview');
        const downloadTranslation = document.getElementById('download-translation');
        const translationFileInfo = document.getElementById('translation-file-info');
        
        const editorUpload = document.getElementById('editor-upload');
        const editorFile = document.getElementById('editor-file');
        const pdfEditor = document.getElementById('pdf-editor');
        const editorStatus = document.getElementById('editor-status');
        const savePdf = document.getElementById('save-pdf');
        const downloadEdited = document.getElementById('download-edited');
        const editorFileInfo = document.getElementById('editor-file-info');
        
        const languageOptions = document.querySelectorAll('.language-option');
        const toolButtons = document.querySelectorAll('.tool-btn');
        
        const translateText = document.getElementById('translate-text');
        const translateLoading = document.getElementById('translate-loading');
        
        // Variables
        let currentTranslationDirection = 'en-ar';
        let currentTool = null;
        let translatedDocument = null;
        let editedPdf = null;
        let currentPdfBytes = null;
        
        // Event Listeners
        translationUpload.addEventListener('click', () => {
            translationFile.click();
        });
        
        translationFile.addEventListener('change', handleTranslationFileUpload);
        
        editorUpload.addEventListener('click', () => {
            editorFile.click();
        });
        
        editorFile.addEventListener('change', handleEditorFileUpload);
        
        translateBtn.addEventListener('click', translateDocument);
        
        downloadTranslation.addEventListener('click', downloadTranslatedFile);
        
        savePdf.addEventListener('click', savePdfChanges);
        
        downloadEdited.addEventListener('click', downloadEditedFile);
        
        languageOptions.forEach(option => {
            option.addEventListener('click', () => {
                languageOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                currentTranslationDirection = option.dataset.direction;
            });
        });
        
        toolButtons.forEach(button => {
            button.addEventListener('click', () => {
                toolButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                currentTool = button.dataset.tool;
                
                // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£Ø¯Ø§Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                applyEditorTool(currentTool);
            });
        });
        
        // Ø¬Ø¹Ù„ Ù…Ù†Ø§Ø·Ù‚ Ø§Ù„Ø±ÙØ¹ Ù‚Ø§Ø¨Ù„Ø© Ù„Ù„Ø³Ø­Ø¨
        makeDropZone(translationUpload, translationFile);
        makeDropZone(editorUpload, editorFile);
        
        // Functions
        function makeDropZone(dropZone, fileInput) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, preventDefaults, false);
            });
            
            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }
            
            ['dragenter', 'dragover'].forEach(eventName => {
                dropZone.addEventListener(eventName, highlight, false);
            });
            
            ['dragleave', 'drop'].forEach(eventName => {
                dropZone.addEventListener(eventName, unhighlight, false);
            });
            
            function highlight() {
                dropZone.classList.add('drag-over');
            }
            
            function unhighlight() {
                dropZone.classList.remove('drag-over');
            }
            
            dropZone.addEventListener('drop', handleDrop, false);
            
            function handleDrop(e) {
                const dt = e.dataTransfer;
                const files = dt.files;
                fileInput.files = files;
                
                if (fileInput.id === 'translation-file') {
                    handleTranslationFileUpload({target: fileInput});
                } else {
                    handleEditorFileUpload({target: fileInput});
                }
            }
        }
        
        function handleTranslationFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const validTypes = ['application/pdf', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document', 'application/msword'];
            if (!validTypes.includes(file.type)) {
                showStatus(translationStatus, 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù PDF Ø£Ùˆ Word', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showStatus(translationStatus, 'Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (10MB)', 'error');
                return;
            }
            
            translationFileInfo.innerHTML = `
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${file.name}</p>
                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${file.type}</p>
                <p><strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
            `;
            
            showStatus(translationStatus, `ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ${file.name}`, 'success');
            downloadTranslation.disabled = false;
            
            // Ù‚Ø±Ø§Ø¡Ø© ÙˆÙ…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù
            readFileForPreview(file, translationPreview, 'translation');
        }
        
        function handleEditorFileUpload(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                showStatus(editorStatus, 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù PDF', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) {
                showStatus(editorStatus, 'Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙŠØªØ¬Ø§ÙˆØ² Ø§Ù„Ø­Ø¯ Ø§Ù„Ù…Ø³Ù…ÙˆØ­ (10MB)', 'error');
                return;
            }
            
            editorFileInfo.innerHTML = `
                <p><strong>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù:</strong> ${file.name}</p>
                <p><strong>Ø§Ù„Ù†ÙˆØ¹:</strong> ${file.type}</p>
                <p><strong>Ø§Ù„Ø­Ø¬Ù…:</strong> ${(file.size / 1024 / 1024).toFixed(2)} MB</p>
            `;
            
            showStatus(editorStatus, `ØªÙ… Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù: ${file.name}`, 'success');
            savePdf.disabled = false;
            downloadEdited.disabled = false;
            
            // Ù‚Ø±Ø§Ø¡Ø© ÙˆÙ…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù
            readFileForPreview(file, pdfEditor, 'editor');
        }
        
        function readFileForPreview(file, element, type) {
            showStatus(type === 'translation' ? translationStatus : editorStatus, 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ù…Ù„Ù...', 'info');
            
            const reader = new FileReader();
            
            reader.onload = function(e) {
                const content = e.target.result;
                
                if (type === 'translation') {
                    if (file.type === 'application/pdf') {
                        renderPdfPreview(content, element);
                    } else {
                        renderWordPreview(content, element);
                    }
                } else {
                    renderPdfForEditing(content, element);
                    currentPdfBytes = content;
                }
            };
            
            if (file.type === 'application/pdf') {
                reader.readAsArrayBuffer(file);
            } else {
                reader.readAsBinaryString(file);
            }
        }
        
        function renderPdfPreview(data, element) {
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… PDF.js Ù„Ø¹Ø±Ø¶ PDF
            element.innerHTML = `
                <div class="text-center">
                    <h3>Ù…Ø¹Ø§ÙŠÙ†Ø© PDF</h3>
                    <p>Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù…Ø­ØªÙˆÙ‰ PDF Ù‡Ù†Ø§ Ø¨Ø¹Ø¯ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©.</p>
                    <p>ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© PDF.js Ù„Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª.</p>
                </div>
            `;
            
            showStatus(translationStatus, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø¹Ø§ÙŠÙ†Ø© PDF...', 'info');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©
            setTimeout(() => {
                element.innerHTML = `
                    <div class="text-center">
                        <h4>${translationFile.files[0].name}</h4>
                        <p>Ù‡Ø°Ù‡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ù„Ù…Ø­ØªÙˆÙ‰ PDF. ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„ØµÙØ­Ø§Øª Ø§Ù„ÙØ¹Ù„ÙŠØ© Ù‡Ù†Ø§.</p>
                        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø© Ø¥Ù„Ù‰ Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ±Ø¬Ù…Ø©.</p>
                    </div>
                `;
            }, 1500);
        }
        
        function renderWordPreview(data, element) {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© mammoth Ù„ØªØ­ÙˆÙŠÙ„ Word Ø¥Ù„Ù‰ HTML
            mammoth.convertToHtml({arrayBuffer: data})
                .then(function(result) {
                    element.innerHTML = result.value;
                    showStatus(translationStatus, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ø³ØªÙ†Ø¯ Word Ø¨Ù†Ø¬Ø§Ø­', 'success');
                })
                .catch(function(err) {
                    console.error(err);
                    element.innerHTML = `
                        <p>Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø³ØªÙ†Ø¯ Word.</p>
                        <p>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø®Ø·Ø£: ${err.message}</p>
                    `;
                    showStatus(translationStatus, 'ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø³ØªÙ†Ø¯ Word', 'error');
                });
        }
        
        function renderPdfForEditing(data, element) {
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… PDF.js Ù„Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù„Ù„ØªØ­Ø±ÙŠØ±
            element.innerHTML = `
                <div class="text-center">
                    <h3>Ù…Ø­Ø±Ø± PDF</h3>
                    <p>Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ PDF Ù„Ù„ØªØ­Ø±ÙŠØ±...</p>
                </div>
            `;
            
            showStatus(editorStatus, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ PDF Ù„Ù„ØªØ­Ø±ÙŠØ±...', 'info');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ù…Ù† PDF
            setTimeout(() => {
                element.innerHTML = `
                    <h4>Ù…Ø­ØªÙˆÙ‰ PDF Ù„Ù„ØªØ­Ø±ÙŠØ±</h4>
                    <p>Ù‡Ø°Ø§ Ù…Ø­ØªÙˆÙ‰ Ù†ØµÙŠ Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ù…Ù„Ù PDF. ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù†Øµ Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­Ø±Ø±.</p>
                    <p>Ø¨Ø¹Ø¯ Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§ØªØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ "Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª" Ø«Ù… "ØªØ­Ù…ÙŠÙ„ PDF Ø§Ù„Ù…Ø¹Ø¯Ù„".</p>
                    <p>ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†Øµ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ Ù…Ù† PDF Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© PDF.js.</p>
                `;
                showStatus(editorStatus, 'ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ù„Ù„ØªØ­Ø±ÙŠØ±', 'success');
            }, 2000);
        }
        
        function translateDocument() {
            if (!translationFile.files[0]) {
                showStatus(translationStatus, 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ø³ØªÙ†Ø¯ Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            translateText.style.display = 'none';
            translateLoading.style.display = 'inline-block';
            translateBtn.disabled = true;
            
            showStatus(translationStatus, 'Ø¬Ø§Ø±ÙŠ ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯...', 'info');
            
            // Ù…Ø­Ø§ÙƒØ§Ø© Ø¹Ù…Ù„ÙŠØ© Ø§Ù„ØªØ±Ø¬Ù…Ø©
            setTimeout(() => {
                const fromLang = currentTranslationDirection === 'en-ar' ? 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©' : 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©';
                const toLang = currentTranslationDirection === 'en-ar' ? 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©' : 'Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©';
                
                // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… API Ù„Ù„ØªØ±Ø¬Ù…Ø© Ù…Ø«Ù„ Google Translate
                translationPreview.innerHTML = `
                    <h3>Ø§Ù„Ù…Ø³ØªÙ†Ø¯ Ø§Ù„Ù…ØªØ±Ø¬Ù… (${fromLang} Ø¥Ù„Ù‰ ${toLang})</h3>
                    <p>Ù‡Ø°Ø§ Ù…Ø­ØªÙˆÙ‰ Ù…ØªØ±Ø¬Ù… Ù…Ù† ${fromLang} Ø¥Ù„Ù‰ ${toLang}. ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø¯Ù…Ø© ØªØ±Ø¬Ù…Ø© ÙØ¹Ù„ÙŠØ© Ù„ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø­ØªÙˆÙ‰.</p>
                    <p>Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù: ${translationFile.files[0].type}</p>
                    <div class="mt-3">
                        <h4>Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ±Ø¬Ù…:</h4>
                        <p>Ù…Ø±Ø­Ø¨Ø§ Ø¨Ùƒ ÙÙŠ Ù†Ø¸Ø§Ù… ØªØ±Ø¬Ù…Ø© Ø§Ù„Ù…Ø³ØªÙ†Ø¯Ø§Øª. Ù‡Ø°Ø§ Ø§Ù„Ù†Øµ Ù‡Ùˆ Ù…Ø«Ø§Ù„ Ø¹Ù„Ù‰ ÙƒÙŠÙÙŠØ© Ø¸Ù‡ÙˆØ± Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ±Ø¬Ù….</p>
                    </div>
                `;
                
                translatedDocument = true;
                showStatus(translationStatus, 'ØªÙ…Øª Ø§Ù„ØªØ±Ø¬Ù…Ø© Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                
                translateText.style.display = 'inline';
                translateLoading.style.display = 'none';
                translateBtn.disabled = false;
            }, 3000);
        }
        
        function downloadTranslatedFile() {
            if (!translatedDocument) {
                showStatus(translationStatus, 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªÙ†Ø¯ Ù…ØªØ±Ø¬Ù… Ù„Ù„ØªØ­Ù…ÙŠÙ„', 'error');
                return;
            }
            
            showStatus(translationStatus, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ù„Ù Ù„Ù„ØªØ­Ù…ÙŠÙ„...', 'info');
            
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ù†Ø´Ø¦ Ù…Ù„Ù PDF Ø£Ùˆ Word Ù…Ø¹ Ø§Ù„ØªØ±Ø¬Ù…Ø©
            setTimeout(() => {
                const fromLang = currentTranslationDirection === 'en-ar' ? 'en' : 'ar';
                const toLang = currentTranslationDirection === 'en-ar' ? 'ar' : 'en';
                const originalName = translationFile.files[0].name;
                const extension = originalName.split('.').pop();
                const baseName = originalName.replace('.' + extension, '');
                const newFileName = `${baseName}_${fromLang}_to_${toLang}.${extension}`;
                
                // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù ÙˆÙ‡Ù…ÙŠ Ù„Ù„ØªØ­Ù…ÙŠÙ„
                const content = "Ù‡Ø°Ø§ Ù…Ù„Ù Ù…ØªØ±Ø¬Ù…. ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ÙƒØ§Ù…Ù„ØŒ Ø³ÙŠÙƒÙˆÙ† Ù‡Ø°Ø§ Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙØ¹Ù„ÙŠ Ø§Ù„Ù…ØªØ±Ø¬Ù….";
                const blob = new Blob([content], {type: 'application/octet-stream'});
                saveAs(blob, newFileName);
                
                showStatus(translationStatus, 'ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…ØªØ±Ø¬Ù…', 'success');
            }, 1000);
        }
        
        function applyEditorTool(tool) {
            switch(tool) {
                case 'text':
                    showStatus(editorStatus, 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø¯Ø§Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ. Ø§Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Øµ ÙÙŠÙ‡.', 'info');
                    break;
                case 'highlight':
                    showStatus(editorStatus, 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø¯Ø§Ø© Ø§Ù„ØªÙ…ÙŠÙŠØ². Ø­Ø¯Ø¯ Ø§Ù„Ù†Øµ Ù„ØªÙ…ÙŠÙŠØ²Ù‡.', 'info');
                    document.execCommand('styleWithCSS', false, true);
                    document.execCommand('hiliteColor', false, '#ffeb3b');
                    break;
                case 'comment':
                    showStatus(editorStatus, 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø£Ø¯Ø§Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ‚. Ø§Ù†Ù‚Ø± ÙÙŠ Ø§Ù„Ù…ÙƒØ§Ù† Ø§Ù„Ù…Ø±Ø§Ø¯ Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ ÙÙŠÙ‡.', 'info');
                    break;
            }
        }
        
        function savePdfChanges() {
            if (!editorFile.files[0]) {
                showStatus(editorStatus, 'Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø±ÙØ¹ Ù…Ù„Ù PDF Ø£ÙˆÙ„Ø§Ù‹', 'error');
                return;
            }
            
            showStatus(editorStatus, 'Ø¬Ø§Ø±ÙŠ Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª...', 'info');
            
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø¯Ù…Ø¬ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙÙŠ PDF
            setTimeout(() => {
                showStatus(editorStatus, 'ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                editedPdf = true;
            }, 1500);
        }
        
        function downloadEditedFile() {
            if (!editedPdf) {
                showStatus(editorStatus, 'Ù„Ø§ ÙŠÙˆØ¬Ø¯ PDF Ù…Ø¹Ø¯Ù„ Ù„Ù„ØªØ­Ù…ÙŠÙ„', 'error');
                return;
            }
            
            showStatus(editorStatus, 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± PDF Ù„Ù„ØªØ­Ù…ÙŠÙ„...', 'info');
            
            // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø³ØªØ®Ø¯Ù… pdf-lib Ù„Ø¥Ù†Ø´Ø§Ø¡ PDF Ù…Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
            setTimeout(async () => {
                try {
                    const originalName = editorFile.files[0].name;
                    const extension = originalName.split('.').pop();
                    const baseName = originalName.replace('.' + extension, '');
                    const newFileName = `${baseName}_edited.${extension}`;
                    
                    // Ø¥Ù†Ø´Ø§Ø¡ PDF Ø¬Ø¯ÙŠØ¯ Ù…Ø¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª
                    const { PDFDocument } = PDFLib;
                    const pdfDoc = await PDFDocument.load(currentPdfBytes);
                    const pages = pdfDoc.getPages();
                    const firstPage = pages[0];
                    
                    // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ Ù†Ø¶ÙŠÙ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ù‡Ù†Ø§
                    firstPage.drawText('ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ø­Ø±Ø± PDF', {
                        x: 50,
                        y: firstPage.getHeight() - 50,
                        size: 12,
                        color: PDFLib.rgb(0.95, 0.1, 0.1),
                    });
                    
                    const pdfBytes = await pdfDoc.save();
                    const blob = new Blob([pdfBytes.buffer], {type: 'application/pdf'});
                    saveAs(blob, newFileName);
                    
                    showStatus(editorStatus, 'ØªÙ… Ø¨Ø¯Ø¡ ØªØ­Ù…ÙŠÙ„ PDF Ø§Ù„Ù…Ø¹Ø¯Ù„', 'success');
                } catch (err) {
                    console.error(err);
                    showStatus(editorStatus, 'Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ù†Ø´Ø§Ø¡ PDF: ' + err.message, 'error');
                }
            }, 1000);
        }
        
        function showStatus(element, message, type) {
            element.textContent = message;
            element.className = 'status';
            if (type) {
                element.classList.add(type);
            }
        }
    </script>
</body>
</html>
